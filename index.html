<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EdikShop</title>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://telegram.org; script-src 'self' https://telegram.org 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src * data:;">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –í–∞—à–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ */
    </style>
</head>
<body>
    <div id="app">
        <header>
            <h1>EDIKSHOP</h1>
            <button id="cartBtn">üõí –ö–æ—Ä–∑–∏–Ω–∞</button>
        </header>
        <div id="gamesContainer">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä...</div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const gamesContainer = document.getElementById('gamesContainer');
        const cartBtn = document.getElementById('cartBtn');
        
        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
        async function loadGames() {
            try {
                // 1. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏
                gamesContainer.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä...</div>';
                
                // 2. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ –±–æ—Ç—É
                tg.sendData(JSON.stringify({
                    action: "get_games",
                    user_id: tg.initDataUnsafe.user?.id
                }));
                
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞:", error);
                showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.");
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –æ—à–∏–±–∫–∏
        function showError(message) {
            gamesContainer.innerHTML = `
                <div class="error">
                    ${message}
                    <button onclick="window.location.reload()">–û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
            `;
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã
        cartBtn.addEventListener('click', () => {
            tg.sendData(JSON.stringify({ action: "open_cart" }));
        });
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', loadGames);
    </script>
</body>
</html>
